[tox]
envlist = py{310, 311, 312, 313}-{linux,macos,win}, flake8, mypy, docs, build, install, upload, check, type-check
skip_missing_interpreters = true
isolated_build = false

[testenv]
platform =
    linux: linux
    macos: darwin
    win: win32
deps =
    pytest
    pytest-xdist
    pytest-cov
    -rrequirements.txt
commands =
    py.test --basetemp={envtmpdir} -vv --cov=src \
            --cov-report=html --cov-report=term-missing tests/

[testenv:check]
description = Validate the `pyproject.toml` file.
skip_install = true
deps =
    packaging
    validate-pyproject
commands =
    validate-pyproject pyproject.toml

[testenv:flake8]
basepython = python3.11
skip_install = true
deps =
    flake8
commands =
    flake8 src/

[testenv:type-check]
description = Run type checking using `mypy`.
basepython = python3.11
skip_install = true
setenv =
    MYPYPATH = {toxinidir}
deps =
    mypy
    numpy
    types-PyYAML
commands =
    # python -m mypy type_stubs/ src/
    python -m mypy src/

[testenv:docs]
basepython = python3.11
skip_install = true
deps =
    autodocsumm
    click
    Cython<3
    numpy
    scikit-rf
    Sphinx
    sphinx_rtd_theme
commands =
    sphinx-build -j auto -b html docs/ docs/_build/

[testenv:build]
basepython = python3.11
skip_install = true
deps =
    build
commands =
    python -m build

[testenv:install]
basepython = python3.11
isolated_build = false
skip_install = false
commands =
    pychopmarg --version

[testenv:upload]
basepython = python3.11
skip_install = true
deps =
    twine
commands =
    # twine upload dist/pychopmarg-1.1.3.tar.gz dist/PyChOpMarg-1.1.3-py3-none-any.whl
    twine upload dist/PyChOpMarg-{[project]version}.tar.gz dist/PyChOpMarg-{[project]version}-py3-none-any.whl

[flake8]
exclude = .tox,*.egg,build,data
select = E,W,F
max-line-length = 120
